# =============================================================================
# LOGA Backend - Local Development (MongoDB Atlas 연결)
# =============================================================================
# 로컬 개발용 Docker Compose
# MongoDB는 Atlas(클라우드)를 사용합니다
#
# 사용법:
#   빌드 및 실행: docker compose -f docker-compose.local.yml up --build
#   백그라운드:   docker compose -f docker-compose.local.yml up --build -d
#   중지:        docker compose -f docker-compose.local.yml down
#   로그 확인:    docker compose -f docker-compose.local.yml logs -f
# =============================================================================

services:
    app:
        build: .
        container_name: loga_local_dev
        ports:
            - '8080:8080'
        environment:
            # Spring 프로파일
            - SPRING_PROFILES_ACTIVE=local
            
            # MongoDB Atlas (클라우드) - Spring Boot 4.0 새로운 프로퍼티명
            - SPRING_MONGODB_URI=mongodb+srv://loga:LzniYtd3ZVcbb0rI@loga.dlm9csq.mongodb.net/log-gacha?retryWrites=true&w=majority&appName=LOGA&connectTimeoutMS=20000&socketTimeoutMS=20000
            
            # MongoDB Health Check 비활성화 (Atlas는 local DB 접근 권한 없음)
            - MANAGEMENT_HEALTH_MONGODB_ENABLED=false
            
            # JWT
            - JWT_SECRET=log-backend-jwt-secret-key-must-be-at-least-256-bits-long-for-security
            
            # Google OAuth2
            - GOOGLE_CLIENT_ID=1079394642223-tr4t15eg4kfk4iplotiu6fr4p4fcfkjp.apps.googleusercontent.com
            - GOOGLE_CLIENT_SECRET=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
            
            # CORS (로컬 개발용)
            - CORS_ALLOWED_ORIGINS=http://localhost:3000,http://127.0.0.1:3000
        volumes:
            - ./logs:/app/logs
        restart: 'no'
        healthcheck:
            test: ['CMD-SHELL', 'curl -f http://localhost:8080/actuator/health || exit 1']
            interval: 30s
            timeout: 10s
            retries: 3
            start_period: 90s
        deploy:
            resources:
                limits:
                    memory: 1024M
                reservations:
                    memory: 512M
        logging:
            driver: 'json-file'
            options:
                max-size: '10m'
                max-file: '3'
